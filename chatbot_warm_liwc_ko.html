<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>G150 ìƒ´í‘¸ ì¶”ì²œ ì±—ë´‡ - ë¶€ë“¤ë´‡ (Warm)</title>
  <style>
    /* === Warm (ì‚´êµ¬í†¤) í…Œë§ˆ === */
    body{
      font-family: Arial, sans-serif;
      background:#fff7f5; margin:0; padding:0;
      display:flex; justify-content:center; align-items:center; min-height:100vh;
    }
    #wrap{ width:430px; max-width:92%; }
    #top{
      display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;
      font-size:12px; color:#7a5a4b;
    }
    #top .pill{ border:1px solid #ffcfb8; background:#fffaf6; padding:4px 8px; border-radius:999px; cursor:pointer; }
    #top .pill:hover{ background:#ffe7da; }

    #chat{
      width:100%; background:#ffece5; border:1px solid #ffd9bf; border-radius:12px;
      box-shadow:0 4px 8px rgba(0,0,0,.08);
      padding:16px; max-height:70vh; overflow-y:auto; line-height:1.8;
    }
    .row{ display:flex; margin:10px 0; }
    .row.bot{ justify-content:flex-start; }
    .row.user{ justify-content:flex-end; }
    .bubble{
      max-width:75%; padding:10px 14px; border-radius:18px; box-shadow:0 1px 1px rgba(0,0,0,.04);
    }
    .bot .bubble{ background:#ffc9b8; color:#4e342e; }
    .user .bubble{ background:#ffd6cc; color:#3e2723; }

    .imgbox{ text-align:center; margin:8px 0; }
    .imgbox img{ max-width:100%; border-radius:10px; border:1px solid #ffd9bf; }

    .buttons{ display:flex; flex-wrap:wrap; gap:8px; justify-content:center; margin-top:8px; }
    .chip{ background:#ffe4d3; color:#5a372a; border:1px solid #ffcfb8; border-radius:12px; padding:8px 10px; cursor:pointer; font-weight:600; }
    .chip.secondary{ background:#fff; }

    .composer{ display:flex; gap:8px; margin-top:10px; }
    .composer input{
      flex:1; padding:12px; border:1px solid #ffcfb8; border-radius:10px; font-size:15px;
      background:#fffaf6; color:#5a372a;
    }
    .composer button{
      min-width:88px; background:#ff8a65; color:#fff; border:none; border-radius:8px; font-weight:700; cursor:pointer; padding:9px 12px;
    }
    .composer button:hover{ background:#ff7043; }
  </style>
</head>
<body>
  <div id="wrap">
    <div id="top">
      <div>G150 ìƒ´í‘¸ì¶”ì²œ <strong>ë¶€ë“¤ë´‡</strong> (Warm)</div>
      <div>
        <button class="pill" onclick="exportCSV('per_turn')">CSV per_turn</button>
        <button class="pill" onclick="exportCSV('per_user')">CSV user_only</button>
      </div>
    </div>

    <div id="chat" aria-live="polite"></div>

    <div class="composer">
      <input id="msg" type="text" placeholder="ì›í•˜ì‹œëŠ” ìƒ´í‘¸ë¥¼ ë§ì”€í•´ ì£¼ì„¸ìš”..." autocomplete="off">
      <button id="send">ì „ì†¡</button>
    </div>
  </div>

  <script>
  (function(){
    const $chat = document.getElementById('chat');
    const $msg  = document.getElementById('msg');
    const $send = document.getElementById('send');

    /* ===== ì´ë¯¸ì§€ ì—ì…‹ (GitHub Pages ê²½ë¡œ) ===== */
    const ASSET = {
      scalp:  { img: "https://zhmoon35.github.io/chatbot-test/G150-Scalp-shampoo.png",   title: "Scalp Shampoo"   },
      balance:{ img: "https://zhmoon35.github.io/chatbot-test/G150-Balance-Shampoo.png", title: "Balance Shampoo" },
      daily:  { img: "https://zhmoon35.github.io/chatbot-test/G150-Daily-shampoo.png",   title: "Daily Shampoo"   }
    };

    /* ===== LIWC ë¡œê¹… & CSV ë‚´ë³´ë‚´ê¸°(ì„ íƒ) ===== */
    const pid  = crypto.randomUUID().slice(0,8);
    const LOG  = { pid, cond:'warm', lang:'ko', page:location.pathname.split('/').pop(), started: Date.now(), turns: [] };
    let lastTs = LOG.started;
    function track(who, text){
      const now = Date.now();
      LOG.turns.push({t: now, who, text: String(text||'').trim(), ms_from_prev: now-lastTs});
      lastTs = now;
    }
    window.exportCSV = function(mode='per_turn'){
      const rows=[];
      if(mode==='per_turn'){
        LOG.turns.forEach((r,i)=>rows.push({pid:LOG.pid,cond:LOG.cond,lang:LOG.lang,page:LOG.page,idx:i,who:r.who,ms_from_prev:r.ms_from_prev,text:r.text.replace(/\s+/g,' ').trim()}));
      }else{
        const merged = LOG.turns.filter(r=>r.who==='user').map(r=>r.text).join(' . ');
        rows.push({pid:LOG.pid,cond:LOG.cond,lang:LOG.lang,page:LOG.page,idx:0,who:'user_all',ms_from_prev:'',text:merged.replace(/\s+/g,' ').trim()});
      }
      if(rows.length===0){ alert('ëŒ€í™”ê°€ ì•„ì§ ì—†ìŠµë‹ˆë‹¤.'); return; }
      const header=Object.keys(rows[0]);
      const csv=[header.join(','),...rows.map(r=>header.map(k=>`"${String(r[k]??'').replace(/"/g,'""')}"`).join(','))].join('\n');
      const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'});
      const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=`liwc_${LOG.pid}_${mode}.csv`;
      document.body.appendChild(a); a.click(); a.remove();
    };

    /* ===== UI ìœ í‹¸ ===== */
    function addBubble(who, html){
      const row=document.createElement('div'); row.className = 'row ' + (who==='bot'?'bot':'user');
      const b=document.createElement('div'); b.className='bubble'; b.innerHTML=html;
      row.appendChild(b); $chat.appendChild(row); $chat.scrollTop=$chat.scrollHeight;
    }
    function addImage(url, alt='Product'){
      const box=document.createElement('div'); box.className='imgbox';
      const img=document.createElement('img'); img.src=url; img.alt=alt;
      box.appendChild(img); $chat.appendChild(box); $chat.scrollTop=$chat.scrollHeight;
    }
    function addButtons(items){
      const area=document.createElement('div'); area.className='buttons';
      items.forEach(cfg=>{
        const btn=document.createElement('button'); btn.className='chip'+(cfg.secondary?' secondary':''); btn.textContent=cfg.text;
        btn.onclick=()=>{ userSay(cfg.text); if(cfg.on) cfg.on(); };
        area.appendChild(btn);
      });
      $chat.appendChild(area); $chat.scrollTop=$chat.scrollHeight;
    }

    /* ===== ë§¤í•‘ ê·œì¹™ =====
       ì§€ì„±/ë¯¼ê° â†’ Balance,  íƒˆëª¨/ë‘í”¼/ë¹„ë“¬ â†’ Scalp,  ê·¸ ì™¸(ë³¼ë¥¨/ì†ìƒ/ê¸°íƒ€) â†’ Daily  */
    function mapProduct(text){
      const t=(text||'').toLowerCase();
      if(t.includes('ì§€ì„±') || t.includes('ë¯¼ê°')) return 'balance';
      if(t.includes('íƒˆëª¨') || t.includes('ë‘í”¼') || t.includes('ë¹„ë“¬')) return 'scalp';
      if(t.includes('ë³¼ë¥¨') || t.includes('ì†ìƒ')) return 'daily';
      return 'daily';
    }

    /* ===== ì¶”ì²œ ì‘ë‹µ ===== */
    function respond(userText){
      const key = mapProduct(userText);
      const msg = {
        balance: "ê³µìœ í•´ ì£¼ì…”ì„œ ê³ ë§ˆì›Œìš”. ì „ë°˜ ê· í˜•ì„ ê°€ë³ê²Œ ìœ ì§€í•˜ëŠ” ìª½ìœ¼ë¡œ í•¨ê»˜ ë³´ì‹œì£ . ğŸ‘‰ ì¶”ì²œ: <strong>Balance Shampoo</strong>",
        scalp:   "ë§ì”€ì„ ë³´ë‹ˆ ë‘í”¼ ì¤‘ì‹¬ ì¼€ì–´ê°€ ìš°ì„ ì´ì—ìš”. ì‚¬ìš© ì¤‘ ë¶ˆí¸ ì‹ í˜¸ë¥¼ í•¨ê»˜ ì‚´í´ë³¼ê²Œìš”. ğŸ‘‰ ì¶”ì²œ: <strong>Scalp Shampoo</strong>",
        daily:   "ë¶€ë‹´ ì—†ì´ ìì£¼ ì“°ê¸° í¸í•œ êµ¬ì„±ì´ ì¢‹ì•„ ë³´ì—¬ìš”. ì‚¬ìš©ê°ì´ ê°€ë²¼ìš´ ë°©í–¥ìœ¼ë¡œ ì•ˆë‚´ë“œë¦´ê²Œìš”. ğŸ‘‰ ì¶”ì²œ: <strong>Daily Shampoo</strong>"
      }[key];
      addBubble('bot', msg); track('bot',`rec:${key}`);
      const a=ASSET[key]; if(a){ addImage(a.img, a.title); track('bot',`[image] ${a.img}`); }
    }

    /* ===== ì‹œì‘/ì´ë²¤íŠ¸ ===== */
    function greet(){
      addBubble('bot', 'ì•ˆë…•í•˜ì„¸ìš”. ì œê°€ ìƒ´í‘¸ ì‡¼í•‘ì„ ë„ì™€ë“œë ¤ë„ ë ê¹Œìš”? ğŸ˜Š');      track('bot','greet-1');
      addBubble('bot', 'ì–´ë–¤ ìƒ´í‘¸ë¥¼ ì°¾ê³  ê³„ì‹ ì§€ í¸í•˜ê²Œ ë§ì”€í•´ ì£¼ì„¸ìš”. ì›í•˜ì‹œëŠ” ì œí’ˆì„ ì°¾ì•„ë“œë¦´ê²Œìš”.'); track('bot','greet-2');
      addButtons([
        {text:'ì§€ì„±'}, {text:'ë¯¼ê°'}, {text:'íƒˆëª¨'}, {text:'ë‘í”¼'}, {text:'ë¹„ë“¬'},
        {text:'ë³¼ë¥¨',secondary:true}, {text:'ì†ìƒ',secondary:true}
      ]);
    }

    function userSay(text){
      addBubble('user', text); track('user', text);
      setTimeout(()=>respond(text), 180);
    }

    $send.addEventListener('click', ()=>{ const v=$msg.value.trim(); if(!v) return; $msg.value=''; userSay(v); });
    $msg.addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); const v=$msg.value.trim(); if(!v) return; $msg.value=''; userSay(v); }});

    greet();
  })();
  </script>
</body>
</html>
