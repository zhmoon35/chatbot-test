<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>G150 ìƒ´í‘¸ì¶”ì²œ ë¶€ë“¤ë´‡ (Warm)</title>
  <style>
    body{
      font-family: Arial, sans-serif;
      background-color:#fff8f0; margin:0; padding:0;
      display:flex; justify-content:center; align-items:center; min-height:100vh;
    }
    #wrap{ width:430px; max-width:92%; }
    #chat{ width:100%; background:#fff3e6; border-radius:10px;
      box-shadow:0 4px 8px rgba(0,0,0,.1);
      padding:20px; overflow-y:auto; max-height:72vh; line-height:1.8;
      border:1px solid #ffd9bf; }
    .bot,.user{ margin:10px 0; display:flex; }
    .bot{ justify-content:flex-start; }
    .user{ justify-content:flex-end; }
    .bubble{ padding:10px 15px; border-radius:20px; max-width:75%; box-shadow:0 1px 1px rgba(0,0,0,.04); }
    .bot .bubble{ background:#ffd8b1; color:#5a372a; }
    .user .bubble{ background:#ffcba4; color:#5a372a; }
    .imgbox{ text-align:center; margin:10px 0; }
    .imgbox img{ max-width:100%; border-radius:10px; border:1px solid #ffd9bf; }
    .buttons{ display:flex; flex-wrap:wrap; gap:8px; justify-content:center; margin-top:8px;}
    .chip{ background:#ffe4d3; color:#5a372a; border:1px solid #ffcfb8; border-radius:12px; padding:8px 10px; cursor:pointer; font-weight:600;}
    .chip.secondary{ background:#fff; }
    .bar{ display:flex; gap:8px; margin-top:10px; }
    .bar input{ flex:1; padding:12px; border:1px solid #ffcfb8; border-radius:10px; font-size:15px; background:#fffaf6; color:#5a372a;}
    .bar button{ min-width:92px; background:#ffad8f; color:#5a372a; border:none; border-radius:8px; font-weight:700; cursor:pointer; padding:9px 12px;}
    .bar button:hover{ background:#e69c7a; }
    .top{ display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; }
    .mini{ font-size:12px; color:#7a5a4b; }
    .pill{ font-size:11px; padding:4px 8px; border-radius:999px; border:1px solid #ffcfb8; background:#fffaf6; cursor:pointer;}
    .pill:hover{ background:#ffe7da; }
  </style>
</head>
<body>
  <div id="wrap">
    <div class="top">
      <div class="mini">G150 ìƒ´í‘¸ì¶”ì²œ <strong>ë¶€ë“¤ë´‡</strong> (Warm)</div>
      <div class="mini">
        <button class="pill" onclick="exportCSV('per_turn')">CSV per_turn</button>
        <button class="pill" onclick="exportCSV('per_user')">CSV user_only</button>
      </div>
    </div>

    <div id="chat" aria-live="polite"></div>

    <div class="bar">
      <input id="msg" type="text" placeholder="ë¬¸ì¥ìœ¼ë¡œ í¸í•˜ê²Œ ì…ë ¥í•´ ì£¼ì„¸ìš”. ì˜ˆ) ë‘í”¼ê°€ ê°€ë µê³  ìœ ë¶„ì´ ë§ì•„ìš” / ë§¤ì¼ ì¨ë„ ìˆœí•œ ìƒ´í‘¸ ìˆì„ê¹Œìš”?" autocomplete="off">
      <button id="send">ë³´ë‚´ê¸°</button>
    </div>
  </div>

  <script>
  (function(){
    const $chat=document.getElementById('chat');
    const $msg=document.getElementById('msg');
    const $send=document.getElementById('send');

    /* ===== LIWC ë¡œê¹… ===== */
    const pid=crypto.randomUUID().slice(0,8);
    const LOG={ pid, cond:'warm', lang:'ko', page:location.pathname.split('/').pop(), started:Date.now(), turns:[] };
    let lastTs=LOG.started;
    function track(who,text){ const now=Date.now(); LOG.turns.push({t:now,who,text:String(text||'').trim(),ms_from_prev:now-lastTs}); lastTs=now; }
    window.exportCSV=function(mode='per_turn'){
      const rows=[];
      if(mode==='per_turn'){
        LOG.turns.forEach((r,i)=>rows.push({pid:LOG.pid,cond:LOG.cond,lang:LOG.lang,page:LOG.page,idx:i,who:r.who,ms_from_prev:r.ms_from_prev,text:r.text.replace(/\s+/g,' ').trim()}));
      }else{
        const merged=LOG.turns.filter(r=>r.who==='user').map(r=>r.text).join(' . ');
        rows.push({pid:LOG.pid,cond:LOG.cond,lang:LOG.lang,page:LOG.page,idx:0,who:'user_all',ms_from_prev:'',text:merged.replace(/\s+/g,' ').trim()});
      }
      if(rows.length===0){ alert('ëŒ€í™” ì—†ìŒ'); return; }
      const header=Object.keys(rows[0]);
      const csv=[header.join(','),...rows.map(r=>header.map(k=>`"${String(r[k]??'').replace(/"/g,'""')}"`).join(','))].join('\n');
      const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'});
      const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=`liwc_${LOG.pid}_${mode}.csv`;
      document.body.appendChild(a); a.click(); a.remove();
    };

    /* ===== UI í•¨ìˆ˜ ===== */
    function addBubble(who,html){
      const row=document.createElement('div'); row.className=(who==='bot'?'bot':'user');
      const b=document.createElement('div'); b.className='bubble'; b.innerHTML=html;
      row.appendChild(b); $chat.appendChild(row); $chat.scrollTop=$chat.scrollHeight;
    }
    function addButtons(list){
      const wrap=document.createElement('div'); wrap.className='buttons';
      list.forEach(cfg=>{
        const btn=document.createElement('button'); btn.className='chip'+(cfg.secondary?' secondary':''); btn.textContent=cfg.text;
        btn.onclick=()=>{ userSay(cfg.text); };
        wrap.appendChild(btn);
      });
      $chat.appendChild(wrap); $chat.scrollTop=$chat.scrollHeight;
    }
    function addCard(img,title,desc){
      const box=document.createElement('div'); box.className='imgbox';
      const im=document.createElement('img'); im.src=img; im.alt=title; box.appendChild(im);
      $chat.appendChild(box);
      addBubble('bot', `<strong>${title}</strong><br>${desc}`);
    }

    /* ===== ì œí’ˆ ì´ë¯¸ì§€/ì„¤ëª… ===== */
    const ASSET={
      scalp:{ img:"https://github.com/zhmoon35/chatbot-test/blob/main/G150-Scalp-shampoo.png?raw=true", title:"Scalp Shampoo", desc:"ë‘í”¼ ì¤‘ì‹¬ ì„¸ì •/ì •ëˆì´ í•„ìš”í•œ ê²½ìš°ì— ì í•©í•©ë‹ˆë‹¤."},
      balance:{ img:"https://github.com/zhmoon35/chatbot-test/blob/main/G150-Balance-Shampoo.png?raw=true", title:"Balance Shampoo", desc:"ì§€ì„±Â·ë¯¼ê° ë“± ì „ì²´ ì»¨ë””ì…˜ì˜ ê· í˜•ì„ ìœ ì§€í•˜ê¸°ì— ì í•©í•©ë‹ˆë‹¤."},
      daily:{ img:"https://github.com/zhmoon35/chatbot-test/blob/main/G150-Daily-shampoo.png?raw=true", title:"Daily Shampoo", desc:"ìì£¼ ì‚¬ìš©í•˜ê¸° ì¢‹ì€ ë§ˆì¼ë“œ íƒ€ì…. í¸ì•ˆí•œ ì‚¬ìš©ê°ì„ ì œê³µí•©ë‹ˆë‹¤."}
    };

    /* ===== ë§¤í•‘ ê·œì¹™(ìš”ì²­ ê³ ì •) =====
       ì§€ì„±/ë¯¼ê° â†’ balance,  íƒˆëª¨/ë‘í”¼/ë¹„ë“¬ â†’ scalp,  ê·¸ ì™¸(ë³¼ë¥¨/ì†ìƒ/ê¸°íƒ€) â†’ daily */
    function mapProduct(text){
      const t=(text||'').toLowerCase();
      if(t.includes('ì§€ì„±')||t.includes('ë¯¼ê°')) return 'balance';
      if(t.includes('íƒˆëª¨')||t.includes('ë‘í”¼')||t.includes('ë¹„ë“¬')) return 'scalp';
      if(t.includes('ë³¼ë¥¨')||t.includes('ì†ìƒ')) return 'daily';
      return 'daily';
    }

    /* ===== íë¦„ ì œì–´ ===== */
    let firstAnswered=false;   // ì²˜ìŒ ì‚¬ìš©ì ì‘ë‹µ ìˆ˜ì§‘ ì—¬ë¶€
    let quickShown=false;      // ë¹ ë¥¸ë²„íŠ¼ ì¤‘ë³µ ë°©ì§€

    function greetOnce(){
      addBubble('bot','ì•ˆë…•í•˜ì„¸ìš”! ì œ ì´ë¦„ì€ <strong>ë¶€ë“¤ë´‡</strong>ì´ë¼ê³  í•´ìš”. ì œê°€ ìƒ´í‘¸ ì‡¼í•‘ì„ ë„ì™€ë“œë¦´ê¹Œìš”? ğŸ˜Š');
      track('bot','greet-1');
      addBubble('bot','ìƒ´í‘¸ë¥¼ ê³ ë¥´ëŠ” ëª©ì ì„ ì•Œë ¤ ì£¼ì‹œë©´, í•´ë‹¹ë˜ëŠ” ì •ë³´ì™€ ì¶”ì²œì„ ì •ë¦¬í•´ ë“œë¦´ê²Œìš”.<br>ë¬¸ì¥ìœ¼ë¡œ í¸í•˜ê²Œ ì…ë ¥í•´ ì£¼ì„¸ìš”. ì˜ˆ) â€œë‘í”¼ê°€ ê°€ë µê³  ìœ ë¶„ì´ ë§ì•„ìš”â€, â€œë§¤ì¼ ì¨ë„ ìˆœí•œ ìƒ´í‘¸ ìˆì„ê¹Œìš”?â€');
      track('bot','greet-2');

      if(!quickShown){
        addButtons([
          {text:'ì§€ì„±'},{text:'ë¯¼ê°'},{text:'íƒˆëª¨'},{text:'ë‘í”¼'},{text:'ë¹„ë“¬'},
          {text:'ë³¼ë¥¨',secondary:true},{text:'ì†ìƒ',secondary:true}
        ]);
        quickShown=true;
      }
    }

    function brandIntro(){
      // Warm í†¤ì˜ ì§§ì€ ë¸Œëœë“œ ì„¤ëª… (í•œ ë²ˆë§Œ)
      addBubble('bot',
        'ì €í¬ <strong>G150</strong>ì€ ê°€ë²¼ìš´ ì‚¬ìš©ê°ê³¼ ì„±ë¶„ ê· í˜•ì„ ì¤‘ìš”í•˜ê²Œ ìƒê°í•´ìš”. '+
        'í•„ìš”ì— ë§ì¶° ì„¸ ê°€ì§€ ë¼ì¸ì„ ì•ˆë‚´ë“œë¦´ê²Œìš”: <em>Scalp</em>(ë‘í”¼ ì§‘ì¤‘), <em>Balance</em>(ê· í˜• ìœ ì§€), <em>Daily</em>(ìì£¼ ì“°ê¸° ì¢‹ì€ íƒ€ì…).'
      );
      track('bot','brand-intro');
    }

    function respondWithRecommendation(text){
      const key=mapProduct(text);
      const a=ASSET[key];
      const warmMsg={
        balance:"ê³µìœ í•´ ì£¼ì…”ì„œ ê³ ë§ˆì›Œìš”. ì „ë°˜ ê· í˜•ì„ ê°€ë³ê²Œ ìœ ì§€í•˜ëŠ” ìª½ìœ¼ë¡œ í•¨ê»˜ ë³´ì‹œì£ .",
        scalp:"ë§ì”€ì„ ë³´ë‹ˆ ë‘í”¼ ì¤‘ì‹¬ ì¼€ì–´ê°€ ìš°ì„ ì´ì—ìš”. ì‚¬ìš© ì¤‘ ë¶ˆí¸ ì‹ í˜¸ë¥¼ í•¨ê»˜ ì‚´í´ë³¼ê²Œìš”.",
        daily:"ë¶€ë‹´ ì—†ì´ ìì£¼ ì“°ê¸° í¸í•œ êµ¬ì„±ì´ ì¢‹ì•„ ë³´ì—¬ìš”. ì‚¬ìš©ê°ì´ ê°€ë²¼ìš´ ë°©í–¥ìœ¼ë¡œ ì•ˆë‚´ë“œë¦´ê²Œìš”."
      }[key];
      addBubble('bot',warmMsg); track('bot',`rec:${key}`);
      addCard(a.img,a.title,a.desc);
    }

    function userSay(text){
      addBubble('user',text); track('user',text);

      // ì²« ì‘ë‹µì´ë¼ë©´: (1)ë¸Œëœë“œ ì†Œê°œ â†’ (2)ì¶”ì²œ
      if(!firstAnswered){
        firstAnswered=true;
        setTimeout(()=>{ brandIntro(); setTimeout(()=>respondWithRecommendation(text), 220); }, 180);
      }else{
        // ì´í›„ì—ëŠ” ë°”ë¡œ ì¶”ì²œë§Œ
        setTimeout(()=>respondWithRecommendation(text), 180);
      }
    }

    // ì „ì†¡ ì´ë²¤íŠ¸
    $send.addEventListener('click',()=>{ const v=$msg.value.trim(); if(!v) return; $msg.value=''; userSay(v); });
    $msg.addEventListener('keydown',e=>{ if(e.key==='Enter'){ e.preventDefault(); const v=$msg.value.trim(); if(!v) return; $msg.value=''; userSay(v); }});

    // ì‹œì‘(ì¤‘ë³µ ë°©ì§€: í•œ ë²ˆë§Œ í˜¸ì¶œ)
    greetOnce();
  })();
  </script>
</body>
</html>
