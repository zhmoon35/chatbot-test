<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>G150 샴푸추천 · 프로봇(유능)</title>
<link rel="preload" as="image" href="./g150-daily.png">
<style>
  :root{
    --bg:#edf5ff; --panel:#ffffff; --bot:#e8f1ff; --user:#dbeaff; --text:#0f1a2b;
    --accent1:#7ab8ff; --accent2:#60a5ff; --glow:rgba(66,153,255,.22);
    --radius:20px; --w:400px;
  }
  body{font-family:Arial,sans-serif;background:var(--bg);margin:0;display:flex;justify-content:center;align-items:center;height:100vh}
  #chat-container{width:var(--w);max-height:90vh;background:var(--panel);border-radius:12px;border:1px solid #cfe3ff;
    box-shadow:0 10px 28px var(--glow),0 2px 8px rgba(0,0,0,.06);padding:20px;overflow-y:auto;line-height:1.8}
  .bot-message,.user-message{margin:10px 0;display:flex}.bot-message{justify-content:flex-start}.user-message{justify-content:flex-end}
  .message{padding:10px 15px;border-radius:var(--radius);max-width:72%;color:var(--text);border:1px solid #cfe3ff}
  .bot-message .message{background:var(--bot)} .user-message .message{background:var(--user)}
  .button-container{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin-top:10px}
  button{background:linear-gradient(135deg,var(--accent1),var(--accent2));color:#fff;border:none;border-radius:12px;padding:10px 16px;cursor:pointer}
  button:hover{filter:brightness(.97)}
  .image-container{text-align:center;margin:10px 0}
  .image-container img{width:100%;height:200px;object-fit:contain;border-radius:12px;border:1px solid #cfe3ff;box-shadow:0 6px 18px var(--glow)}
</style>
</head>
<body>
<div id="chat-container" aria-live="polite"></div>

<script>
const box = document.getElementById('chat-container');
const IMG_URL = "./g150-daily.png";

/* 대화: 모든 항목을 'text' 키로 통일(문자열) */
const convo = [
  { type:'bot',
    text:'안녕하세요. 프로봇입니다. 찾으시는 샴푸 용도를 알려주시면 신속하고 정확하게 안내하겠습니다.',
    buttons:[{label:'두피 문제 해결',next:1},{label:'건강한 모발 관리',next:1}]
  },
  { type:'bot',
    text:'원하시는 항목을 선택해 주세요. 핵심 정보를 순서대로 제공하겠습니다.',
    buttons:[{label:'효능/근거',next:2},{label:'성분/기전',next:2},{label:'사용 가이드',next:2}]
  },
  { type:'bot',
    text:'추천 제품은 <b>G150 Daily Shampoo</b>입니다. 내부 시험 요약에서 2주 사용 후 자극 민감도 지표 감소가 관찰되었습니다.',
    image:IMG_URL,
    buttons:[{label:'계속',next:3}]
  },
  { type:'bot',
    text:'주요 활성 성분은 판테놀·알란토인으로 각질층 보습·진정에 기여합니다. 계면활성제 블렌드는 세정력 대비 자극도를 낮추도록 최적화되었습니다.',
    buttons:[{label:'계속',next:4}]
  },
  { type:'bot',
    text:'일반 권장 빈도는 주 3–4회입니다. 도포 후 1–2분 유지한 뒤 충분히 헹굽니다. 사용 주기를 표준화하면 결과의 재현성이 높아집니다.',
    buttons:[{label:'자극이 걱정됩니다',next:5}]
  },
  { type:'bot',
    text:'저자극 관련 항목은 피부과적 테스트를 통과했습니다. 상세 내용은 제품 라벨과 시험 요약본에서 확인 가능합니다.',
    buttons:[]
  }
];

function addRow(kind, html){
  const row=document.createElement('div');
  row.className = (kind==='bot') ? 'bot-message' : 'user-message';
  const msg=document.createElement('div'); msg.className='message';
  msg.innerHTML = html;
  row.appendChild(msg); box.appendChild(row); box.scrollTop = box.scrollHeight;
}
function addImage(url){
  const div=document.createElement('div'); div.className='image-container';
  const img=document.createElement('img'); img.src=url; img.alt='G150 Daily Shampoo bottle'; img.loading='eager';
  div.appendChild(img); box.appendChild(div); box.scrollTop = box.scrollHeight;
}
function addButtons(btns){
  const wrap=document.createElement('div'); wrap.className='button-container';
  btns.forEach(b=>{
    const el=document.createElement('button'); el.textContent=b.label;
    el.onclick=()=>{ addRow('user', b.label); if(b.next!==undefined && b.next!==null) step(b.next); };
    wrap.appendChild(el);
  });
  box.appendChild(wrap); box.scrollTop = box.scrollHeight;
}
function clearButtons(){ box.querySelectorAll('.button-container').forEach(n=>n.remove()); }

/* ✅ 견고한 step: text → message 순 폴백 + 비어있으면 경고 */
function step(i){
  clearButtons();
  const s = convo[i];
  if(!s){ console.warn('[Probot] missing step', i); return; }
  const raw = (typeof s.text==='function') ? s.text() : (s.text ?? s.message ?? '');
  if(!raw){ console.warn('[Probot] empty text at step', i, s); }
  addRow('bot', raw);
  if(s.image) addImage(s.image);
  if(s.buttons && s.buttons.length) addButtons(s.buttons);
}

/* 이미지 프리로드 후 시작(깃허브페이지 캐시 이슈 예방) */
(function init(){
  const img = new Image();
  img.onload = ()=>{ step(0); };
  img.onerror = ()=>{ console.warn('[Probot] image preload failed, starting anyway'); step(0); };
  img.src = IMG_URL;
})();
</script>
</body>
</html>
