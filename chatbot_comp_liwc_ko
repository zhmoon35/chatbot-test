<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>Competent 챗봇 (KO2 • Concreteness)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root{--bg:#fafafa;--panel:#ffffff;--bot:#f3f4f6;--user:#2563eb;--ink:#111}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,Segoe UI,Roboto,Apple SD Gothic Neo,Malgun Gothic,sans-serif}
    .wrap{max-width:780px;margin:0 auto;padding:16px}
    h1{font-size:18px;margin:8px 0 12px}
    .chat{height:58vh;min-height:420px;background:var(--panel);border:1px solid #e5e7eb;border-radius:14px;overflow:auto;padding:10px 12px}
    .bubble{max-width:85%;padding:10px 12px;border-radius:16px;margin:10px 0;box-shadow:0 1px 1px rgba(0,0,0,.04);white-space:pre-wrap}
    .bot{background:var(--bot)}
    .user{background:var(--user);color:#fff;margin-left:auto}
    .composer{display:flex;gap:8px;margin-top:12px}
    .composer input{flex:1;padding:12px;border:1px solid #e5e7eb;border-radius:12px;font-size:16px}
    .composer button{padding:12px 16px;border:0;border-radius:12px;background:#111;color:#fff;font-weight:600;cursor:pointer}
    .meta{font-size:12px;color:#6b7280;margin-top:6px}
    .notes{margin-top:14px;font-size:12px;color:#374151;line-height:1.5;background:#fff;border:1px dashed #d1d5db;border-radius:10px;padding:10px}
    .row{display:flex;gap:8px;justify-content:flex-end;margin-top:8px}
    .badge{display:inline-block;font-size:11px;border:1px solid #d1d5db;border-radius:10px;padding:3px 8px;background:#fff}
    @media (prefers-color-scheme:dark){
      :root{--bg:#0b0c0f;--panel:#0f1115;--bot:#151821;--ink:#e5e7eb}
      .composer input{background:#0f1115;color:var(--ink);border-color:#151821}
      .composer button{background:#e5e7eb;color:#0b0c0f}
      .notes{background:#0f1115;border-color:#374151}
      .badge{background:#0f1115;border-color:#374151}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Competent 챗봇 (KO2)</h1>
    <div class="meta">URL 예시: <code>?conc=high</code> 또는 <code>?conc=low</code> (기본 high)</div>

    <div id="chat" class="chat" role="log" aria-live="polite"></div>

    <div class="composer" role="group" aria-label="메시지 작성">
      <input id="msg" type="text" placeholder="필요 용도 입력 (예: 지성, 민감두피, 탈모케어, 볼륨, 손상모)" autocomplete="off">
      <button id="send" type="button">보내기</button>
    </div>
    <div class="row">
      <button class="badge" onclick="exportLIWCcsv('per_turn')">Export CSV (per_turn)</button>
      <button class="badge" onclick="exportLIWCcsv('per_user')">Export CSV (user_only)</button>
    </div>

    <div class="notes">
      <strong>Research Notes</strong><br>
      • <u>Kull et al., 2021 (JBR)</u>: 첫 인사로 성격 조작(Competent) → 본 파일은 인사를 능력·효율 중심으로 고정.<br>
      • <u>Ruan et al., 2020</u>: 텍스트만으로 성격 지각 가능, 턴·단어·행태 로그 수집 → 로깅 및 LIWC 내보내기 포함.<br>
      • <u>Jiménez-Barreto et al., 2023 (JIM)</u>: 언어의 <em>구체성</em>이 유능성·효율성 지각을 강화 → <code>conc=high/low</code>로 절차·수치의 구체성 조작.
    </div>
  </div>

  <!-- ===== 로깅 & LIWC 내보내기 (Ruan 2020; Kull 2021) ===== -->
  <script>
  (function(){
    const qp = new URLSearchParams(location.search);
    const pid  = qp.get('pid') || crypto.randomUUID().slice(0,8);
    const conc = (qp.get('conc') || 'high').toLowerCase();   // high|low (JIM 2023)
    const cond = 'comp';                                     // Competent 고정 (Kull 2021)
    const lang = 'ko';
    const page = location.pathname.split('/').pop();

    const LOG = { pid, cond, conc, lang, page, started: Date.now(), turns: [] };
    let lastTs = LOG.started;

    window._trackUser = function(text){
      const now = Date.now();
      LOG.turns.push({t:now, who:'user', text:String(text||'').trim(), ms_from_prev: now-lastTs});
      lastTs = now;
    };
    window._trackBot = function(text){
      const now = Date.now();
      LOG.turns.push({t:now, who:'bot', text:String(text||'').trim(), ms_from_prev: now-lastTs});
      lastTs = now;
    };

    window.exportLIWCcsv = function(mode='per_turn'){
      const rows=[];
      if(mode==='per_turn'){
        LOG.turns.forEach((r,i)=>rows.push({
          pid:LOG.pid,cond:LOG.cond,conc:LOG.conc,lang:LOG.lang,page:LOG.page,idx:i,who:r.who,ms_from_prev:r.ms_from_prev,
          text:r.text.replace(/\s+/g,' ').trim()
        }));
      }else{
        const mergedUser = LOG.turns.filter(r=>r.who==='user').map(r=>r.text).join(' . ');
        rows.push({pid:LOG.pid,cond:LOG.cond,conc:LOG.conc,lang:LOG.lang,page:LOG.page,idx:0,who:'user_all',
          ms_from_prev:'',text:mergedUser.replace(/\s+/g,' ').trim()});
      }
      const header=Object.keys(rows[0]||{text:''});
      const csv=[header.join(','),...rows.map(r=>header.map(k=>`"${String(r[k]??'').replace(/"/g,'""')}"`).join(','))].join('\n');
      const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'}); const a=document.createElement('a');
      a.href=URL.createObjectURL(blob); a.download=`liwc_${LOG.pid}_${mode}.csv`; document.body.appendChild(a); a.click(); a.remove();
    };

    // UI
    const $chat=document.getElementById('chat'), $msg=document.getElementById('msg'), $send=document.getElementById('send');
    function addBubble(text, who='bot'){
      const div=document.createElement('div'); div.className=`bubble ${who==='bot'?'bot':'user'}`;
      div.textContent=text; $chat.appendChild(div); $chat.scrollTop=$chat.scrollHeight;
    }

    // Greeting (Competent 고정) — Concreteness 조작
    function greeting(){
      const g = (conc==='high')
        ? "안녕하세요. 필요한 용도를 입력하면 ‘상태 확인 → 사용 단계 → 주의 요약’ 순서로 안내합니다. 각 단계는 시간·순서 기준으로 제시됩니다."
        : "안녕하세요. 필요한 용도를 입력하시면 일반적인 안내가 제공됩니다.";
      addBubble(g,'bot'); _trackBot(g);
    }

    // 키워드 매핑
    const MAP=[
      {keys:['지성','oily','유분','oil'],slot:'oily'},
      {keys:['민감','sensitive','자극','가려움','itch'],slot:'sensitive'},
      {keys:['탈모','hair-loss','hairloss','density'],slot:'hairloss'},
      {keys:['볼륨','volume','루트','root'],slot:'volume'},
      {keys:['손상','damaged','손상모','케어','repair'],slot:'damaged'},
    ];
    function detectNeed(s){
      const t=(s||'').toLowerCase();
      for(const m of MAP){ if(m.keys.some(k=>t.includes(k))) return m.slot; }
      return null;
    }

    // Competent 톤 × Concreteness(높음/낮음) 응답
    const RESP = {
      high: { // 구체적: 단계/시간/순서( Jiménez-Barreto 2023 )
        oily:     "입력: 지성. ① 프리린스 30–45초(미온수) → ② 두피 거품화 20–30초(손끝, 압력 약하게) → ③ 헹굼 45–60초(목덜미→정수리). 주의: 과도 마찰·고온 건조 회피.",
        sensitive:"입력: 민감. ① 접촉 시간 단축 20–30초 → ② 손톱 사용 금지, 지문 사용 → ③ 미지근한 물 충분 헹굼 → ④ 드라이 거리 15–20cm 유지. 주의: 향 강한 제품 병행 자제.",
        hairloss: "입력: 탈모 관심. ① 두피 중심 단시간 세정 20–30초 → ② 뿌리 리프트 건조(정수리·옆머리 각도 유지) → ③ 잔여물 누적 점검(스타일링 후). 주의: 고열·과도 제품층 회피.",
        volume:   "입력: 볼륨. ① 거품 과다 사용 금지 → ② 헹굼 시 뿌리 흔들기 15–20회 → ③ 드라이 시 브러시 각도 30–45° 유지. 주의: 장시간 고온 바람 회피.",
        damaged:  "입력: 손상. ① 거품 장시간 방치 금지(≤30초) → ② 타월로 수분 압착 후 → ③ 끝부분부터 빗질 진행 → ④ 고열 도구 빈도 주 1–2회 이하. 주의: 표면 마찰 최소화."
      },
      low: {  // 모호·요약형
        oily:     "지성으로 인식되었습니다. 일반 절차에 따라 세정과 헹굼을 완료한 뒤 건조를 진행하세요.",
        sensitive:"민감으로 인식되었습니다. 짧은 사용과 온도·마찰 관리를 권장합니다.",
        hairloss: "탈모 관심으로 인식되었습니다. 세정 후 건조 단계와 잔여물 누적 여부를 점검하세요.",
        volume:   "볼륨 관심으로 인식되었습니다. 사용 중 무게감을 줄이고 건조 시 형태를 확인하세요.",
        damaged:  "손상으로 인식되었습니다. 거칠음과 빗질 진행 상태를 확인하고 고열 사용을 줄이세요."
      }
    };

    function respond(slot){
      const text = slot ? RESP[conc][slot] : "입력값을 인식하지 못했습니다. 지성/민감두피/탈모케어/볼륨/손상모 중에서 입력해 주세요.";
      addBubble(text,'bot'); _trackBot(text);
    }

    function onSend(){
      const v=$msg.value.trim(); if(!v) return;
      addBubble(v,'user'); _trackUser(v); $msg.value='';
      const slot=detectNeed(v); setTimeout(()=>respond(slot), 280);
    }
    $send.addEventListener('click', onSend);
    $msg.addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); onSend(); }});

    greeting();
  })();
  </script>
</body>
</html> 
